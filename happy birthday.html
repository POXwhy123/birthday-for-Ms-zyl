<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>生日快乐</title>
  <style>
    /* --- 1. 全局样式与背景氛围 --- */
    body, html {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      font-family: 'Microsoft YaHei', 'PingFang SC', sans-serif;
      background: linear-gradient(125deg, #0f0c29, #302b63, #24243e);
      background-size: 400% 400%;
      animation: bgMove 15s ease infinite;
    }

    @keyframes bgMove {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* --- 2. 弹出的文本气泡样式 (毛玻璃风格) --- */
    .message-bubble {
      position: absolute;
      padding: 15px 25px;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: #fff;
      font-size: 1.1rem;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      opacity: 0;
      transform: scale(0.5);
      transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      z-index: 10;
      user-select: none;
      cursor: default;
    }

    .message-bubble.show {
      opacity: 1;
      transform: scale(1);
    }

    /* --- 3. 最后的生日大标题样式 --- */
    #final-layer {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 100;
      opacity: 0;
      pointer-events: none;
      transition: opacity 2s ease;
      overflow: hidden; /* 给特效留保险 */
    }

    #final-layer.active {
      opacity: 1;
      pointer-events: auto;
    }

    .main-title {
      font-size: 4rem;
      font-weight: bold;
      color: transparent;
      background: linear-gradient(to right, #ff9966, #ff5e62);
      -webkit-background-clip: text;
      text-shadow: 0 0 30px rgba(255, 94, 98, 0.5);
      margin-bottom: 20px;
      transform: translateY(50px);
      transition: transform 1s ease;
      z-index: 2;
      text-align: center;
      padding: 0 16px;
    }

    .sub-title {
      font-size: 1.5rem;
      color: #eee;
      letter-spacing: 5px;
      transform: translateY(50px);
      transition: transform 1s ease 0.3s;
      z-index: 2;
      text-align: center;
      padding: 0 16px;
    }

    #final-layer.active .main-title,
    #final-layer.active .sub-title {
      transform: translateY(0);
    }

    /* --- 4. 特效画布层 --- */
    .fx-canvas {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      z-index: 1; /* 在文字下方、遮罩上方 */
      pointer-events: none;
    }

    /* --- 5. 音乐按钮（低调高级） --- */
    #music-btn {
      position: fixed;
      right: 16px;
      bottom: 16px;
      z-index: 200;
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 14px;
      border-radius: 14px;
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.18);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      color: #fff;
      font-size: 12px;
      letter-spacing: 1px;
      cursor: pointer;
      user-select: none;
      transition: transform .2s ease, background .2s ease, border-color .2s ease;
    }
    #music-btn:hover { transform: translateY(-2px); }
    #music-btn .dot {
      width: 8px; height: 8px; border-radius: 50%;
      background: rgba(255,255,255,0.5);
      box-shadow: 0 0 10px rgba(255,255,255,0.25);
      transition: background .2s ease, box-shadow .2s ease;
    }
    #music-btn.playing .dot {
      background: #7CFFB2;
      box-shadow: 0 0 12px rgba(124,255,178,0.6);
    }

    /* 简单浮动动画 */
    @keyframes float {
      0%, 100% { transform: translateY(0) scale(1); }
      50% { transform: translateY(-10px) scale(1); }
    }

    @media (max-width: 768px) {
      .message-bubble { font-size: 0.9rem; padding: 10px 15px; }
      .main-title { font-size: 2.5rem; }
      .sub-title { font-size: 1rem; letter-spacing: 3px; }
    }
  </style>
</head>
<body>

  <div id="bubble-container"></div>

  <!-- 最终祝福层 -->
  <div id="final-layer">
    <!-- 特效画布：烟花 -->
    <canvas id="fireworks-canvas" class="fx-canvas"></canvas>
    <!-- 特效画布：彩带 -->
    <canvas id="confetti-canvas" class="fx-canvas"></canvas>

    <div class="main-title" id="final-big-text">生日快乐</div>
    <div class="sub-title" id="final-sub-text">愿你岁岁平安，万事顺意</div>
  </div>

  <!-- 音乐（URL 由你填） -->
  <audio id="bgm" preload="auto" loop></audio>
  <div id="music-btn" title="音乐">
    <span class="dot"></span>
    <span id="music-label">MUSIC OFF</span>
  </div>

  <script>
    /* ============================================================
      自定义区
    ============================================================ */

    const config = {
      messageList: [
        "嘿！",
        "是你吗？",
        "今天是个特别的日子",
        "记得看看窗外的星星",
        "也看看这里的文字",
        "这一年辛苦啦",
        "所有的努力",
        "都会变成光",
        "照亮前行的路",
        "准备好了吗？",
        "我要说那句话了...",
        "3",
        "2",
        "1",
        "0"
      ],
      finalBigText: "Happy Birthday!",
      finalSubText: "永远自由，永远热泪盈眶",

      /* ✅ 你只需要把这里换成你的音乐链接即可 */
      musicUrl: "YOUR_MUSIC_URL_HERE"
    };

    /* ============================================================
      气泡逻辑
    ============================================================ */

    const container = document.getElementById('bubble-container');
    const finalLayer = document.getElementById('final-layer');

    document.getElementById('final-big-text').innerText = config.finalBigText;
    document.getElementById('final-sub-text').innerText = config.finalSubText;

    let index = 0;

    function showNextMessage() {
      if (index >= config.messageList.length) {
        setTimeout(showFinalLayer, 1000);
        return;
      }
      const text = config.messageList[index];
      createBubble(text);
      index++;
      setTimeout(showNextMessage, 800);
    }

    function createBubble(text) {
      const bubble = document.createElement('div');
      bubble.classList.add('message-bubble');
      bubble.innerText = text;

      const approxWidth = 160;
      const approxHeight = 80;
      const maxWidth = Math.max(0, window.innerWidth - approxWidth);
      const maxHeight = Math.max(0, window.innerHeight - approxHeight);

      const randomX = Math.random() * maxWidth;
      const randomY = Math.random() * maxHeight;

      bubble.style.left = randomX + 'px';
      bubble.style.top = randomY + 'px';
      bubble.style.animation = `float 3s ease-in-out infinite`;
      bubble.style.animationDelay = Math.random() + 's';

      container.appendChild(bubble);

      requestAnimationFrame(() => {
        bubble.classList.add('show');
      });
    }

    function showFinalLayer() {
      finalLayer.classList.add('active');
      startFinalEffects();
      tryAutoPlayMusic();
    }

    window.onload = function() {
      setTimeout(showNextMessage, 500);
    };

    /* ============================================================
      ✅ 音乐逻辑（兼容 iOS 限制）
    ============================================================ */

    const bgm = document.getElementById('bgm');
    const musicBtn = document.getElementById('music-btn');
    const musicLabel = document.getElementById('music-label');

    if (config.musicUrl && config.musicUrl !== "YOUR_MUSIC_URL_HERE") {
      bgm.src = config.musicUrl;
    }

    function setMusicUI(isPlaying) {
      musicBtn.classList.toggle('playing', isPlaying);
      musicLabel.textContent = isPlaying ? "MUSIC ON" : "MUSIC OFF";
    }

    async function playMusic() {
      if (!bgm.src) return;
      try {
        await bgm.play();
        setMusicUI(true);
      } catch (e) {
        // iOS 未触发手势时会失败，保持 OFF 状态即可
        setMusicUI(false);
      }
    }

    function pauseMusic() {
      bgm.pause();
      setMusicUI(false);
    }

    musicBtn.addEventListener('click', () => {
      if (!bgm.src) return;
      if (bgm.paused) playMusic();
      else pauseMusic();
    });

    // 页面任意首次交互时尝试播放（更容易满足移动端策略）
    let firstGestureUnlocked = false;
    function unlockOnFirstGesture() {
      if (firstGestureUnlocked) return;
      firstGestureUnlocked = true;
      playMusic();
      window.removeEventListener('pointerdown', unlockOnFirstGesture);
      window.removeEventListener('touchstart', unlockOnFirstGesture);
      window.removeEventListener('keydown', unlockOnFirstGesture);
    }
    window.addEventListener('pointerdown', unlockOnFirstGesture);
    window.addEventListener('touchstart', unlockOnFirstGesture);
    window.addEventListener('keydown', unlockOnFirstGesture);

    function tryAutoPlayMusic() {
      // 若浏览器允许，会在最终层出现时自动播放
      playMusic();
    }

    /* ============================================================
      ✅ 最终层特效：烟花 + 彩带
      - 只在 final-layer 激活后启动
    ============================================================ */

    const fwCanvas = document.getElementById('fireworks-canvas');
    const cfCanvas = document.getElementById('confetti-canvas');
    const fwCtx = fwCanvas.getContext('2d');
    const cfCtx = cfCanvas.getContext('2d');

    function resizeFxCanvas() {
      const w = window.innerWidth;
      const h = window.innerHeight;
      fwCanvas.width = w; fwCanvas.height = h;
      cfCanvas.width = w; cfCanvas.height = h;
    }
    window.addEventListener('resize', resizeFxCanvas);
    resizeFxCanvas();

    /* ---------- 烟花实现（轻量级粒子） ---------- */
    const fireworks = [];
    const sparks = [];
    let fwLastLaunch = 0;

    function launchFirework() {
      const w = fwCanvas.width;
      const h = fwCanvas.height;
      const x = Math.random() * w * 0.8 + w * 0.1;
      const y = h;
      const targetY = Math.random() * h * 0.35 + h * 0.08;

      fireworks.push({
        x, y,
        vx: (Math.random() - 0.5) * 1.2,
        vy: -(6 + Math.random() * 3.5),
        targetY,
        exploded: false
      });
    }

    function explode(fw) {
      const count = 60 + Math.floor(Math.random() * 40);
      const hueBase = Math.random() * 360;

      for (let i = 0; i < count; i++) {
        const angle = (Math.PI * 2) * (i / count);
        const speed = 1.5 + Math.random() * 3.5;

        sparks.push({
          x: fw.x,
          y: fw.y,
          vx: Math.cos(angle) * speed + (Math.random() - 0.5) * 0.6,
          vy: Math.sin(angle) * speed + (Math.random() - 0.5) * 0.6,
          life: 60 + Math.random() * 30,
          maxLife: 90,
          hue: (hueBase + Math.random() * 40) % 360,
          size: 1 + Math.random() * 1.8
        });
      }
    }

    function updateFireworks() {
      const now = performance.now();
      if (now - fwLastLaunch > 520) {
        launchFirework();
        fwLastLaunch = now;
      }

      for (let i = fireworks.length - 1; i >= 0; i--) {
        const fw = fireworks[i];
        fw.x += fw.vx;
        fw.y += fw.vy;
        fw.vy += 0.08; // 重力

        if (!fw.exploded && fw.y <= fw.targetY) {
          fw.exploded = true;
          explode(fw);
          fireworks.splice(i, 1);
        } else if (fw.y > fwCanvas.height + 50) {
          fireworks.splice(i, 1);
        }
      }

      for (let i = sparks.length - 1; i >= 0; i--) {
        const p = sparks[i];
        p.x += p.vx;
        p.y += p.vy;
        p.vy += 0.02;
        p.vx *= 0.985;
        p.vy *= 0.985;
        p.life--;

        if (p.life <= 0) sparks.splice(i, 1);
      }
    }

    function drawFireworks() {
      fwCtx.clearRect(0, 0, fwCanvas.width, fwCanvas.height);

      // 轻微拖影，让烟花更柔
      fwCtx.fillStyle = "rgba(0,0,0,0.15)";
      fwCtx.fillRect(0, 0, fwCanvas.width, fwCanvas.height);

      // 火箭
      for (const fw of fireworks) {
        fwCtx.beginPath();
        fwCtx.arc(fw.x, fw.y, 2.2, 0, Math.PI * 2);
        fwCtx.fillStyle = "rgba(255,255,255,0.9)";
        fwCtx.fill();
      }

      // 爆炸粒子
      for (const p of sparks) {
        const alpha = Math.max(0, p.life / p.maxLife);
        fwCtx.beginPath();
        fwCtx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
        fwCtx.fillStyle = `hsla(${p.hue}, 100%, 70%, ${alpha})`;
        fwCtx.fill();
      }
    }

    /* ---------- 彩带实现（confetti 粒子） ---------- */
    const confetti = [];
    let cfLastEmit = 0;

    function emitConfettiBurst() {
      const w = cfCanvas.width;
      const h = cfCanvas.height;
      const originX = Math.random() * w * 0.6 + w * 0.2;
      const originY = -20;

      const pieces = 60 + Math.floor(Math.random() * 40);
      for (let i = 0; i < pieces; i++) {
        confetti.push({
          x: originX,
          y: originY,
          vx: (Math.random() - 0.5) * 2.5,
          vy: 1.5 + Math.random() * 3.5,
          rot: Math.random() * Math.PI,
          vr: (Math.random() - 0.5) * 0.15,
          w: 6 + Math.random() * 8,
          h: 10 + Math.random() * 14,
          life: 220 + Math.random() * 80,
          hue: Math.random() * 360
        });
      }
    }

    function updateConfetti() {
      const now = performance.now();
      if (now - cfLastEmit > 900) {
        emitConfettiBurst();
        cfLastEmit = now;
      }

      for (let i = confetti.length - 1; i >= 0; i--) {
        const c = confetti[i];
        c.x += c.vx;
        c.y += c.vy;
        c.vy += 0.02;
        c.vx *= 0.995;
        c.rot += c.vr;
        c.life--;

        if (c.y > cfCanvas.height + 60 || c.life <= 0) {
          confetti.splice(i, 1);
        }
      }
    }

    function drawConfetti() {
      cfCtx.clearRect(0, 0, cfCanvas.width, cfCanvas.height);
      for (const c of confetti) {
        const alpha = Math.min(1, c.life / 200);
        cfCtx.save();
        cfCtx.translate(c.x, c.y);
        cfCtx.rotate(c.rot);
        cfCtx.fillStyle = `hsla(${c.hue}, 90%, 65%, ${alpha})`;
        cfCtx.fillRect(-c.w/2, -c.h/2, c.w, c.h);
        cfCtx.restore();
      }
    }

    /* ---------- 总控循环 ---------- */
    let fxRunning = false;

    function startFinalEffects() {
      if (fxRunning) return;
      fxRunning = true;

      // 初始爆发感：让“出现即高潮”
      for (let i = 0; i < 3; i++) launchFirework();
      emitConfettiBurst();

      function loop() {
        if (!fxRunning) return;

        updateFireworks();
        drawFireworks();

        updateConfetti();
        drawConfetti();

        requestAnimationFrame(loop);
      }
      loop();
    }

    // 如果你未来想加“停止特效”按钮，可调用这个
    function stopFinalEffects() {
      fxRunning = false;
      fireworks.length = 0;
      sparks.length = 0;
      confetti.length = 0;
      fwCtx.clearRect(0, 0, fwCanvas.width, fwCanvas.height);
      cfCtx.clearRect(0, 0, cfCanvas.width, cfCanvas.height);
    }
  </script>
</body>
</html>